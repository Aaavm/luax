# crypt: cryptography module

``` lua
local crypt = require "crypt"
```

`crypt` provides cryptography functions.

## Random number generator

The LuaX pseudorandom number generator is a [linear congruential
generator](https://en.wikipedia.org/wiki/Linear_congruential_generator).
This generator is not a cryptographically secure pseudorandom number
generator. It can be used as a repeatable generator (e.g.Â for repeatable
tests).

LuaX has a global generator (with a global seed) and can instantiate
independant generators with their own seeds.

### Random number generator instance

``` lua
local rng = crypt.prng(seed)
```

returns a random number generator starting from the optional seed
`seed`. This object has four methods: `srand(seed)`, `rand([m, [n]])`,
`rands([bytes])` and `randf([a, [b]])`.

``` lua
rng:srand([seed])
```

sets the seed of the PRNG. The default seed is a number based on the
current time and the process id.

``` lua
rng:rand()
```

returns a random integral number between `0` and `crypt.RAND_MAX`.

``` lua
rng:rand(m)
```

returns a random integral number between `1` and `m`.

``` lua
rng:rand(m, n)
```

returns a random integral number between `m` and `n`.

``` lua
rng:randf()
```

returns a random floating point number between `0.0` and `1.0`.

``` lua
rng:randf(a)
```

returns a random floating point number between `0.0` and `a`.

``` lua
rng:randf(a, b)
```

returns a random floating point number between `a` and `b`.

``` lua
rng:rands(bytes)
```

returns a string with `bytes` random bytes.

### Global random number generator

``` lua
crypt.srand([seed])
```

sets the seed of the global PRNG. The default seed is a number based on
the current time and the process id.

``` lua
crypt.rand()
```

returns a random integral number between `0` and `crypt.RAND_MAX`.

``` lua
crypt.rand(m)
```

returns a random integral number between `1` and `m`.

``` lua
crypt.rand(m, n)
```

returns a random integral number between `m` and `n`.

``` lua
crypt.randf()
```

returns a random floating point number between `0.0` and `1.0`.

``` lua
crypt.randf(a)
```

returns a random floating point number between `0.0` and `a`.

``` lua
crypt.randf(a, b)
```

returns a random floating point number between `a` and `b`.

``` lua
crypt.rands(bytes)
```

returns a string with `bytes` random bytes.

## Hexadecimal encoding

The hexadecimal encoder transforms a string into a string where bytes
are coded with hexadecimal digits.

``` lua
crypt.hex_encode(data)
```

encodes `data` in hexa.

``` lua
crypt.hex_decode(data)
```

decodes the hexa `data`.

## Base64 encoding

The base64 encoder transforms a string with non printable characters
into a printable string (see <https://en.wikipedia.org/wiki/Base64>)

``` lua
crypt.base64_encode(data)
```

encodes `data` in base64.

``` lua
crypt.base64_decode(data)
```

decodes the base64 `data`.

``` lua
crypt.base64url_encode(data)
```

encodes `data` in base64url.

``` lua
crypt.base64url_decode(data)
```

decodes the base64url `data`.

## CRC32 hash

The CRC-32 algorithm has been generated by [pycrc](https://pycrc.org/)
with the `crc-32` algorithm.

``` lua
crypt.crc32(data)
```

computes the CRC32 of `data`.

## CRC64 hash

The CRC-64 algorithm has been generated by [pycrc](https://pycrc.org/)
with the `crc-64-xz` algorithm.

``` lua
crypt.crc64(data)
```

computes the CRC64 of `data`.

## RC4 encryption

RC4 is a stream cipher (see <https://en.wikipedia.org/wiki/RC4>). It is
design to be fast and simple.

``` lua
crypt.rc4(data, key, [drop])
```

encrypts/decrypts `data` using the RC4Drop algorithm and the encryption
key `key` (drops the first `drop` encryption steps, the default value of
`drop` is 768).

## TinyCrypt library

The `crypt` contains functions from
[TinyCrypt](https://github.com/intel/tinycrypt).

### SHA256 hash

``` lua
crypt.sha256(data)
```

returns the SHA256 digest of `data`.

### HMAC-SHA256 hash

``` lua
crypt.hmac(data, key)
```

returns the HMAC-SHA256 digest of `data` using `key` as a key.

### HMAC-SHA256 random number generator

``` lua
crypt.hmac_prng(personalization)
```

returns a HMAC PRNG initialized with `personalization` (32 bytes or
more) and some OS dependant entropy. This object has three methods:
`srand(seed)`, `rand([bytes])` and `frand()`.

### CTR random number generator

``` lua
crypt.ctr_prng(personalization)
```

returns a CTR PRNG initialized with `personalization` (32 bytes of more)
and some OS dependant entropy. This object has three methods:
`srand(seed)`, `rand([bytes])` and `frand()`.

### AES-128 encryption

``` lua
crypt.aes_encrypt(data, key)
```

encrypts `data` using the AES-128-CBC algorithm and the encryption key
`key`.

``` lua
crypt.aes_decrypt(data, key)
```

decrypts `data` using the AES-128-CBC algorithm and the encryption key
`key`.

## String methods

Some functions of the `crypt` package are added to the string module:

``` lua
s:hex_encode()          == crypt.hex_encode(s)
s:hex_decode()          == crypt.hex_decode(s)
s:base64_encode()       == crypt.base64_encode(s)
s:base64_decode()       == crypt.base64_decode(s)
s:base64url_encode()    == crypt.base64url_encode(s)
s:base64url_decode()    == crypt.base64url_decode(s)
s:crc32()               == crypt.crc32(s)
s:crc64()               == crypt.crc64(s)
s:rc4(key, drop)        == crypt.crc64(s, key, drop)
s:sha256()              == crypt.sha256(s)
s:hmac(key)             == crypt.hmac(s, key)
s:aes_encrypt(key)      == crypt.aes_encrypt(s, key)
s:aes_decrypt(key)      == crypt.aes_decrypt(s, key)
```
